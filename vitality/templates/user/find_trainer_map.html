<style>
    #map {
        height: 500px;
        width: 100%;
    }
</style>

<script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
<script
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAO-g-4D9U2--jzyTPvNwOlsd_zu56ebdo&callback=initMap&libraries=places&v=weekly"
    defer></script>

<div id="map"></div>

<script>
    function search() {
        event.preventDefault();
        console.log("creating markers");
                var markers = [];
                var infowindows = [];
                var latlng;
                var i;
                data = {{ json_trainers | tojson }};
                console.log(data);

                for (i = 0; i < data.length; i++) {
                    console.log("creating one marker");
                    console.log(data[i].lat, data[i].lng, data[i].username)
                    latlng = new google.maps.LatLng(data[i].lat, data[i].lng);
                    markers[i] = new google.maps.Marker({
                        map,
                        anchorPoint: new google.maps.Point(0, -29),
                        position: latlng
                    });
                    infowindows[i] = new google.maps.InfoWindow();
                    infowindows[i].setContent(data[i].username);
                    markers[i].addListener("click", () => {
                        infowindows[i].open(map, marker);
                    });
                }
        }

    function initMap() {
        var userLat = parseFloat($("#lat").val());
        var userLng = parseFloat($("#lng").val());

        if ((userLng == null || userLat == null)) {
            userLat = 35.2270869;
            userLng = -80.8431267;
        }

        const map = new google.maps.Map(document.getElementById("map"), {
            center: { lat: userLat, lng: userLng },
            zoom: 12,
        });

        const infowindow = new google.maps.InfoWindow();
        infowindow.setContent("Your location");
        const marker = new google.maps.Marker({
            map,
            anchorPoint: new google.maps.Point(0, -29),
            position: map.center
        });
        infowindow.open(map, marker);
        marker.addListener("click", () => {
            infowindow.open(map, marker);
        });
    }
</script>